(self.webpackChunkbuildbuddy_docs_website=self.webpackChunkbuildbuddy_docs_website||[]).push([[6861],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return _}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=d(e,["components","mdxType","originalType","parentName"]),m=s(n),_=i,p=m["".concat(l,".").concat(_)]||m[_]||c[_]||r;return n?a.createElement(p,o(o({ref:t},u),{},{components:n})):a.createElement(p,o({ref:t},u))}));function _(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var d={};for(var l in t)hasOwnProperty.call(t,l)&&(d[l]=t[l]);d.originalType=e,d.mdxType="string"==typeof e?e:i,o[1]=d;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3793:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return d},toc:function(){return l},default:function(){return u}});var a=n(2122),i=n(9756),r=(n(7294),n(3905)),o={id:"prometheus-metrics",title:"Prometheus Metrics",sidebar_label:"Prometheus Metrics"},d={unversionedId:"prometheus-metrics",id:"prometheus-metrics",isDocsHomePage:!1,title:"Prometheus Metrics",description:"BuildBuddy exposes Prometheus metrics that allow monitoring the",source:"@site/../docs/prometheus-metrics.md",sourceDirName:".",slug:"/prometheus-metrics",permalink:"/docs/prometheus-metrics",editUrl:"https://github.com/buildbuddy-io/buildbuddy/edit/master/docs/../docs/prometheus-metrics.md",version:"current",sidebar_label:"Prometheus Metrics",frontMatter:{id:"prometheus-metrics",title:"Prometheus Metrics",sidebar_label:"Prometheus Metrics"},sidebar:"someSidebar",previous:{title:"API Documentation",permalink:"/docs/enterprise-api"},next:{title:"Configuring BuildBuddy",permalink:"/docs/config"}},l=[{value:"Invocation log uploads",id:"invocation-log-uploads",children:[{value:"<strong><code>buildbuddy_invocation_count</code></strong> (Counter)",id:"buildbuddy_invocation_count-counter",children:[]},{value:"<strong><code>buildbuddy_invocation_duration_usec</code></strong> (Histogram)",id:"buildbuddy_invocation_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_invocation_build_event_count</code></strong> (Counter)",id:"buildbuddy_invocation_build_event_count-counter",children:[]}]},{value:"Remote cache metrics",id:"remote-cache-metrics",children:[{value:"<strong><code>buildbuddy_remote_cache_events</code></strong> (Counter)",id:"buildbuddy_remote_cache_events-counter",children:[]},{value:"<strong><code>buildbuddy_remote_cache_download_size_bytes</code></strong> (Histogram)",id:"buildbuddy_remote_cache_download_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_cache_download_duration_usec</code></strong> (Histogram)",id:"buildbuddy_remote_cache_download_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_cache_upload_size_bytes</code></strong> (Histogram)",id:"buildbuddy_remote_cache_upload_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_cache_upload_duration_usec</code></strong> (Histogram)",id:"buildbuddy_remote_cache_upload_duration_usec-histogram",children:[]}]},{value:"Remote execution metrics",id:"remote-execution-metrics",children:[{value:"<strong><code>buildbuddy_remote_execution_count</code></strong> (Counter)",id:"buildbuddy_remote_execution_count-counter",children:[]},{value:"<strong><code>buildbuddy_remote_execution_executed_action_metadata_durations_usec</code></strong> (Histogram)",id:"buildbuddy_remote_execution_executed_action_metadata_durations_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_execution_queue_length</code></strong> (Gauge)",id:"buildbuddy_remote_execution_queue_length-gauge",children:[]},{value:"<strong><code>buildbuddy_remote_execution_tasks_executing</code></strong> (Gauge)",id:"buildbuddy_remote_execution_tasks_executing-gauge",children:[]},{value:"<strong><code>buildbuddy_remote_execution_assigned_ram_bytes</code></strong> (Gauge)",id:"buildbuddy_remote_execution_assigned_ram_bytes-gauge",children:[]},{value:"<strong><code>buildbuddy_remote_execution_assigned_milli_cpu</code></strong> (Gauge)",id:"buildbuddy_remote_execution_assigned_milli_cpu-gauge",children:[]},{value:"<strong><code>buildbuddy_remote_execution_file_download_count</code></strong> (Histogram)",id:"buildbuddy_remote_execution_file_download_count-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_execution_file_download_size_bytes</code></strong> (Histogram)",id:"buildbuddy_remote_execution_file_download_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_execution_file_download_duration_usec</code></strong> (Histogram)",id:"buildbuddy_remote_execution_file_download_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_execution_file_upload_count</code></strong> (Histogram)",id:"buildbuddy_remote_execution_file_upload_count-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_execution_file_upload_size_bytes</code></strong> (Histogram)",id:"buildbuddy_remote_execution_file_upload_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_remote_execution_file_upload_duration_usec</code></strong> (Histogram)",id:"buildbuddy_remote_execution_file_upload_duration_usec-histogram",children:[]}]},{value:"Blobstore metrics",id:"blobstore-metrics",children:[{value:"<strong><code>buildbuddy_blobstore_read_count</code></strong> (Counter)",id:"buildbuddy_blobstore_read_count-counter",children:[]},{value:"<strong><code>buildbuddy_blobstore_read_size_bytes</code></strong> (Histogram)",id:"buildbuddy_blobstore_read_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_blobstore_read_duration_usec</code></strong> (Histogram)",id:"buildbuddy_blobstore_read_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_blobstore_write_count</code></strong> (Counter)",id:"buildbuddy_blobstore_write_count-counter",children:[]},{value:"<strong><code>buildbuddy_blobstore_write_size_bytes</code></strong> (Histogram)",id:"buildbuddy_blobstore_write_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_blobstore_write_duration_usec</code></strong> (Histogram)",id:"buildbuddy_blobstore_write_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_blobstore_delete_count</code></strong> (Counter)",id:"buildbuddy_blobstore_delete_count-counter",children:[]},{value:"<strong><code>buildbuddy_blobstore_delete_duration_usec</code></strong> (Histogram)",id:"buildbuddy_blobstore_delete_duration_usec-histogram",children:[]}]},{value:"Query / error rate metrics",id:"query--error-rate-metrics",children:[{value:"<strong><code>buildbuddy_sql_query_count</code></strong> (Counter)",id:"buildbuddy_sql_query_count-counter",children:[]},{value:"<strong><code>buildbuddy_sql_query_duration_usec</code></strong> (Histogram)",id:"buildbuddy_sql_query_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_sql_error_count</code></strong> (Counter)",id:"buildbuddy_sql_error_count-counter",children:[]}]},{value:"<code>database/sql</code> metrics",id:"databasesql-metrics",children:[{value:"<strong><code>buildbuddy_sql_max_open_connections</code></strong> (Gauge)",id:"buildbuddy_sql_max_open_connections-gauge",children:[]},{value:"<strong><code>buildbuddy_sql_open_connections</code></strong> (Gauge)",id:"buildbuddy_sql_open_connections-gauge",children:[]},{value:"<strong><code>buildbuddy_sql_wait_count</code></strong> (Counter)",id:"buildbuddy_sql_wait_count-counter",children:[]},{value:"<strong><code>buildbuddy_sql_wait_duration_usec</code></strong> (Counter)",id:"buildbuddy_sql_wait_duration_usec-counter",children:[]},{value:"<strong><code>buildbuddy_sql_max_idle_closed</code></strong> (Counter)",id:"buildbuddy_sql_max_idle_closed-counter",children:[]},{value:"<strong><code>buildbuddy_sql_max_idle_time_closed</code></strong> (Counter)",id:"buildbuddy_sql_max_idle_time_closed-counter",children:[]},{value:"<strong><code>buildbuddy_sql_max_lifetime_closed</code></strong> (Counter)",id:"buildbuddy_sql_max_lifetime_closed-counter",children:[]}]},{value:"HTTP metrics",id:"http-metrics",children:[{value:"<strong><code>buildbuddy_http_request_count</code></strong> (Counter)",id:"buildbuddy_http_request_count-counter",children:[]},{value:"<strong><code>buildbuddy_http_request_handler_duration_usec</code></strong> (Histogram)",id:"buildbuddy_http_request_handler_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_http_response_size_bytes</code></strong> (Histogram)",id:"buildbuddy_http_response_size_bytes-histogram",children:[]}]},{value:"Internal metrics",id:"internal-metrics",children:[{value:"Build event handler",id:"build-event-handler",children:[]},{value:"<strong><code>buildbuddy_build_event_handler_duration_usec</code></strong> (Histogram)",id:"buildbuddy_build_event_handler_duration_usec-histogram",children:[]},{value:"Cache",id:"cache",children:[]},{value:"<strong><code>buildbuddy_cache_get_count</code></strong> (Counter)",id:"buildbuddy_cache_get_count-counter",children:[]},{value:"<strong><code>buildbuddy_cache_get_duration_usec</code></strong> (Histogram)",id:"buildbuddy_cache_get_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_get_size_bytes</code></strong> (Histogram)",id:"buildbuddy_cache_get_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_read_count</code></strong> (Counter)",id:"buildbuddy_cache_read_count-counter",children:[]},{value:"<strong><code>buildbuddy_cache_read_duration_usec</code></strong> (Histogram)",id:"buildbuddy_cache_read_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_read_size_bytes</code></strong> (Histogram)",id:"buildbuddy_cache_read_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_set_count</code></strong> (Counter)",id:"buildbuddy_cache_set_count-counter",children:[]},{value:"<strong><code>buildbuddy_cache_set_duration_usec</code></strong> (Histogram)",id:"buildbuddy_cache_set_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_set_size_bytes</code></strong> (Histogram)",id:"buildbuddy_cache_set_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_set_retries</code></strong> (Histogram)",id:"buildbuddy_cache_set_retries-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_write_count</code></strong> (Counter)",id:"buildbuddy_cache_write_count-counter",children:[]},{value:"<strong><code>buildbuddy_cache_write_duration_usec</code></strong> (Histogram)",id:"buildbuddy_cache_write_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_write_size_bytes</code></strong> (Histogram)",id:"buildbuddy_cache_write_size_bytes-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_write_retries</code></strong> (Histogram)",id:"buildbuddy_cache_write_retries-histogram",children:[]},{value:"Other cache metrics",id:"other-cache-metrics",children:[]},{value:"<strong><code>buildbuddy_cache_delete_count</code></strong> (Counter)",id:"buildbuddy_cache_delete_count-counter",children:[]},{value:"<strong><code>buildbuddy_cache_delete_duration_usec</code></strong> (Histogram)",id:"buildbuddy_cache_delete_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_contains_count</code></strong> (Counter)",id:"buildbuddy_cache_contains_count-counter",children:[]},{value:"<strong><code>buildbuddy_cache_contains_duration_usec</code></strong> (Histogram)",id:"buildbuddy_cache_contains_duration_usec-histogram",children:[]},{value:"<strong><code>buildbuddy_cache_contains_retry_count</code></strong> (Histogram)",id:"buildbuddy_cache_contains_retry_count-histogram",children:[]}]}],s={toc:l};function u(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"BuildBuddy exposes ",(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io"},"Prometheus")," metrics that allow monitoring the\n",(0,r.kt)("a",{parentName:"p",href:"https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/"},"four golden signals"),":\nlatency, traffic, errors, and saturation."),(0,r.kt)("p",null,"To view these metrics in a live-updating dashboard, we recommend using a tool\nlike ",(0,r.kt)("a",{parentName:"p",href:"https://grafana.com"},"Grafana"),"."),(0,r.kt)("h2",{id:"invocation-log-uploads"},"Invocation log uploads"),(0,r.kt)("p",null,"All invocation metrics are recorded at the ",(0,r.kt)("em",{parentName:"p"},"end")," of each invocation."),(0,r.kt)("h3",{id:"buildbuddy_invocation_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_invocation_count"))," (Counter)"),(0,r.kt)("p",null,"The total number of invocations whose logs were uploaded to BuildBuddy."),(0,r.kt)("h4",{id:"labels"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"invocation_status"),": Invocation status: ",(0,r.kt)("inlineCode",{parentName:"li"},"success"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"failure"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"disconnected"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"unknown"),".")),(0,r.kt)("h4",{id:"examples"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Number of invocations per second by invocation status\nsum by (invocation_status) (rate(buildbuddy_invocation_count[5m]))\n\n# Invocation success rate\nsum(rate(buildbuddy_invocation_count{invocation_status="success"}[5m]))\n  /\nsum(rate(buildbuddy_invocation_count[5m]))\n')),(0,r.kt)("h3",{id:"buildbuddy_invocation_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_invocation_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"The total duration of each invocation, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-1"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"invocation_status"),": Invocation status: ",(0,r.kt)("inlineCode",{parentName:"li"},"success"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"failure"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"disconnected"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"unknown"),".")),(0,r.kt)("h4",{id:"examples-1"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Median invocation duration in the past 5 minutes\nhistogram_quantile(\n  0.5,\n  sum(rate(buildbuddy_invocation_duration_usec_bucket[5m])) by (le)\n)\n")),(0,r.kt)("h3",{id:"buildbuddy_invocation_build_event_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_invocation_build_event_count"))," (Counter)"),(0,r.kt)("p",null,"Number of ",(0,r.kt)("a",{parentName:"p",href:"https://docs.bazel.build/versions/master/build-event-protocol.html"},"build events")," uploaded to BuildBuddy."),(0,r.kt)("h4",{id:"labels-2"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),".")),(0,r.kt)("h4",{id:"examples-2"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Build events uploaded per second\nsum(rate(buildbuddy_invocation_build_event_count[5m]))\n\n# Approximate error rate of build event upload handler\nsum(rate(buildbuddy_invocation_build_event_count{status="0"}[5m]))\n  /\nsum(rate(buildbuddy_invocation_build_event_count[5m]))\n')),(0,r.kt)("h2",{id:"remote-cache-metrics"},"Remote cache metrics"),(0,r.kt)("p",null,"NOTE: Cache metrics are recorded at the end of each invocation,\nwhich means that these metrics provide ",(0,r.kt)("em",{parentName:"p"},"approximate")," real-time signals."),(0,r.kt)("h3",{id:"buildbuddy_remote_cache_events-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_cache_events"))," (Counter)"),(0,r.kt)("p",null,"Number of cache events handled."),(0,r.kt)("h4",{id:"labels-3"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cache_type"),": Cache type: ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," for action cache, ",(0,r.kt)("inlineCode",{parentName:"li"},"cas")," for content-addressable storage."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cache_event_type"),": Cache event type: ",(0,r.kt)("inlineCode",{parentName:"li"},"hit"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"miss"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"upload"),".")),(0,r.kt)("h3",{id:"buildbuddy_remote_cache_download_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_cache_download_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Number of bytes downloaded from the remote cache in each download."),(0,r.kt)("p",null,"Use the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"_sum"))," suffix to get the total downloaded bytes and the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"_count"))," suffix to get the number of downloaded files."),(0,r.kt)("h4",{id:"labels-4"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cache_type"),": Cache type: ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," for action cache, ",(0,r.kt)("inlineCode",{parentName:"li"},"cas")," for content-addressable storage.")),(0,r.kt)("h4",{id:"examples-3"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Cache download rate (bytes per second)\nsum(rate(buildbuddy_cache_download_size_bytes_sum[5m]))\n")),(0,r.kt)("h3",{id:"buildbuddy_remote_cache_download_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_cache_download_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Download duration for each file downloaded from the remote cache, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-5"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cache_type"),": Cache type: ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," for action cache, ",(0,r.kt)("inlineCode",{parentName:"li"},"cas")," for content-addressable storage.")),(0,r.kt)("h4",{id:"examples-4"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Median download duration for content-addressable store (CAS)\nhistogram_quantile(\n  0.5,\n  sum(rate(buildbuddy_remote_cache_download_duration_usec{cache_type="cas"}[5m])) by (le)\n)\n')),(0,r.kt)("h3",{id:"buildbuddy_remote_cache_upload_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_cache_upload_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Number of bytes uploaded to the remote cache in each upload."),(0,r.kt)("p",null,"Use the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"_sum"))," suffix to get the total uploaded bytes and the ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"_count"))," suffix to get the number of uploaded files."),(0,r.kt)("h4",{id:"labels-6"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cache_type"),": Cache type: ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," for action cache, ",(0,r.kt)("inlineCode",{parentName:"li"},"cas")," for content-addressable storage.")),(0,r.kt)("h4",{id:"examples-5"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Cache upload rate (bytes per second)\nsum(rate(buildbuddy_cache_upload_size_bytes_sum[5m]))\n")),(0,r.kt)("h3",{id:"buildbuddy_remote_cache_upload_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_cache_upload_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Upload duration for each file uploaded to the remote cache, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-7"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cache_type"),": Cache type: ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," for action cache, ",(0,r.kt)("inlineCode",{parentName:"li"},"cas")," for content-addressable storage.")),(0,r.kt)("h4",{id:"examples-6"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Median upload duration for content-addressable store (CAS)\nhistogram_quantile(\n  0.5,\n  sum(rate(buildbuddy_remote_cache_upload_duration_usec{cache_type="cas"}[5m])) by (le)\n)\n')),(0,r.kt)("h2",{id:"remote-execution-metrics"},"Remote execution metrics"),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_count"))," (Counter)"),(0,r.kt)("p",null,"Number of actions executed remotely."),(0,r.kt)("h4",{id:"labels-8"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"exit_code"),": Process exit code of an executed action.")),(0,r.kt)("h4",{id:"examples-7"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Total number of actions executed per second\nsum(rate(buildbuddy_remote_execution_count[5m]))\n")),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_executed_action_metadata_durations_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_executed_action_metadata_durations_usec"))," (Histogram)"),(0,r.kt)("p",null,"Time spent in each stage of action execution, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("p",null,"Queries should filter or group by the ",(0,r.kt)("inlineCode",{parentName:"p"},"stage")," label, taking care not to aggregate different stages."),(0,r.kt)("h4",{id:"labels-9"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"stage"),": Command provided to the Bazel daemon: ",(0,r.kt)("inlineCode",{parentName:"li"},"run"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"test"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"build"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"coverage"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"mobile-install"),", ... Executed action stage. Action execution is split into stages corresponding to the timestamps defined in ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/buildbuddy-io/buildbuddy/blob/fb2e3a74083d82797926654409dc3858089d260b/proto/remote_execution.proto#L797"},(0,r.kt)("inlineCode",{parentName:"a"},"ExecutedActionMetadata")),": ",(0,r.kt)("inlineCode",{parentName:"li"},"queued"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"input_fetch"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"execution"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"output_upload"),". An additional stage, ",(0,r.kt)("inlineCode",{parentName:"li"},"worker"),", includes all stages during which a worker is handling the action, which is all stages except the ",(0,r.kt)("inlineCode",{parentName:"li"},"queued")," stage.")),(0,r.kt)("h4",{id:"examples-8"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Median duration of all command stages\nhistogram_quantile(\n  0.5,\n  sum(rate(buildbuddy_remote_execution_executed_action_metadata_durations_usec_bucket[5m])) by (le, stage)\n)\n\n# p90 duration of just the command execution stage\nhistogram_quantile(\n  0.9,\n  sum(rate(buildbuddy_remote_execution_executed_action_metadata_durations_usec_bucket{stage="execution"}[5m])) by (le)\n)\n')),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_queue_length-gauge"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_queue_length"))," (Gauge)"),(0,r.kt)("p",null,"Number of actions currently waiting in the executor queue."),(0,r.kt)("h4",{id:"examples-9"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Median queue length across all executors\nquantile(0.5, buildbuddy_remote_execution_queue_length)\n")),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_tasks_executing-gauge"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_tasks_executing"))," (Gauge)"),(0,r.kt)("p",null,"Number of tasks currently being executed by the executor."),(0,r.kt)("h4",{id:"examples-10"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Fraction of idle executors\ncount_values(0, buildbuddy_remote_execution_tasks_executing)\n  /\ncount(buildbuddy_remote_execution_tasks_executing)\n")),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_assigned_ram_bytes-gauge"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_assigned_ram_bytes"))," (Gauge)"),(0,r.kt)("p",null,"Estimated RAM on the executor that is currently allocated for task execution, in ",(0,r.kt)("strong",{parentName:"p"},"bytes"),"."),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_assigned_milli_cpu-gauge"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_assigned_milli_cpu"))," (Gauge)"),(0,r.kt)("p",null,"Estimated CPU time on the executor that is currently allocated for task execution, in Kubernetes milliCPU."),(0,r.kt)("h4",{id:"examples-11"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Average CPU allocated to tasks (average is computed across executor instances).\n# `label_replace` is needed because we export k8s pod name as "pod_name" in Prometheus,\n# while k8s exports it as "pod".\navg(\n  buildbuddy_remote_execution_used_milli_cpu\n    /\n  on (pod_name) (label_replace(\n    kube_pod_container_resource_limits_cpu_cores{pod=~"executor-.*"},\n    "pod_name", "$1", "pod", "(.*)"\n  ) * 1000 * 0.6)\n)\n')),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_file_download_count-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_file_download_count"))," (Histogram)"),(0,r.kt)("p",null,"Number of files downloaded during remote execution."),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_file_download_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_file_download_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Total number of bytes downloaded during remote execution."),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_file_download_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_file_download_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Per-file download duration during remote execution, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_file_upload_count-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_file_upload_count"))," (Histogram)"),(0,r.kt)("p",null,"Number of files uploaded during remote execution."),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_file_upload_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_file_upload_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Total number of bytes uploaded during remote execution."),(0,r.kt)("h3",{id:"buildbuddy_remote_execution_file_upload_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_remote_execution_file_upload_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Per-file upload duration during remote execution, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h2",{id:"blobstore-metrics"},"Blobstore metrics"),(0,r.kt)("p",null,'"Blobstore" refers to the backing storage that BuildBuddy uses to\nstore objects in the cache, as well as certain pieces of temporary\ndata (such as invocation events while an invocation is in progress).'),(0,r.kt)("h3",{id:"buildbuddy_blobstore_read_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_read_count"))," (Counter)"),(0,r.kt)("p",null,"Number of files read from the blobstore."),(0,r.kt)("h4",{id:"labels-10"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_read_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_read_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Number of bytes read from the blobstore per file."),(0,r.kt)("h4",{id:"labels-11"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Bytes downloaded per second\nsum(rate(buildbuddy_blobstore_read_size_bytes[5m]))\n")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_read_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_read_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Duration per blobstore file read, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-12"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_write_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_write_count"))," (Counter)"),(0,r.kt)("p",null,"Number of files written to the blobstore."),(0,r.kt)("h4",{id:"labels-13"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Bytes uploaded per second\nsum(rate(buildbuddy_blobstore_write_size_bytes[5m]))\n")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_write_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_write_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Number of bytes written to the blobstore per file."),(0,r.kt)("h4",{id:"labels-14"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_write_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_write_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Duration per blobstore file write, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-15"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_delete_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_delete_count"))," (Counter)"),(0,r.kt)("p",null,"Number of files deleted from the blobstore."),(0,r.kt)("h4",{id:"labels-16"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("h3",{id:"buildbuddy_blobstore_delete_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_blobstore_delete_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Delete duration per blobstore file deletion, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-17"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"blobstore_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"disk"),".")),(0,r.kt)("h1",{id:"sql-metrics"},"SQL metrics"),(0,r.kt)("p",null,"The following metrics are for monitoring the SQL database configured\nfor BuildBuddy."),(0,r.kt)("p",null,"If you'd like to see an up-to-date catalog of what BuildBuddy stores in\nits SQL database, see the table definitions ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/buildbuddy-io/buildbuddy/blob/master/server/tables/tables.go"},"here"),"."),(0,r.kt)("h2",{id:"query--error-rate-metrics"},"Query / error rate metrics"),(0,r.kt)("h3",{id:"buildbuddy_sql_query_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_query_count"))," (Counter)"),(0,r.kt)("p",null,"Number of SQL queries executed."),(0,r.kt)("h4",{id:"labels-18"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_query_template"),": SQL query before substituting template parameters.")),(0,r.kt)("h4",{id:"examples-12"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# SQL queries per second (by query template).\nsum by (sql_query_template) (rate(buildbuddy_sql_query_count[5m]))\n")),(0,r.kt)("h3",{id:"buildbuddy_sql_query_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_query_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"SQL query duration, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-19"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_query_template"),": SQL query before substituting template parameters.")),(0,r.kt)("h4",{id:"examples-13"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Median SQL query duration\nhistogram_quantile(\n  0.5,\n  sum(rate(buildbuddy_sql_query_duration_usec_bucket[5m])) by (le)\n)\n")),(0,r.kt)("h3",{id:"buildbuddy_sql_error_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_error_count"))," (Counter)"),(0,r.kt)("p",null,"Number of SQL queries that resulted in an error."),(0,r.kt)("h4",{id:"labels-20"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_query_template"),": SQL query before substituting template parameters.")),(0,r.kt)("h4",{id:"examples-14"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# SQL error rate\nsum(rate(buildbuddy_sql_error_count[5m]))\n  /\nsum(rate(buildbuddy_sql_query_count[5m]))\n")),(0,r.kt)("h2",{id:"databasesql-metrics"},(0,r.kt)("inlineCode",{parentName:"h2"},"database/sql")," metrics"),(0,r.kt)("p",null,"The following metrics directly expose\n",(0,r.kt)("a",{parentName:"p",href:"https://golang.org/pkg/database/sql/#DBStats"},"DBStats")," from the\n",(0,r.kt)("inlineCode",{parentName:"p"},"database/sql")," Go package."),(0,r.kt)("h3",{id:"buildbuddy_sql_max_open_connections-gauge"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_max_open_connections"))," (Gauge)"),(0,r.kt)("p",null,"Maximum number of open connections to the database."),(0,r.kt)("h4",{id:"labels-21"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h3",{id:"buildbuddy_sql_open_connections-gauge"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_open_connections"))," (Gauge)"),(0,r.kt)("p",null,"The number of established connections to the database."),(0,r.kt)("h4",{id:"labels-22"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"connection_status"),": Status of the database connection: ",(0,r.kt)("inlineCode",{parentName:"li"},"in_use")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"idle")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h3",{id:"buildbuddy_sql_wait_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_wait_count"))," (Counter)"),(0,r.kt)("p",null,"The total number of connections waited for."),(0,r.kt)("h4",{id:"labels-23"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h3",{id:"buildbuddy_sql_wait_duration_usec-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_wait_duration_usec"))," (Counter)"),(0,r.kt)("p",null,"The total time blocked waiting for a new connection, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-24"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h3",{id:"buildbuddy_sql_max_idle_closed-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_max_idle_closed"))," (Counter)"),(0,r.kt)("p",null,"The total number of connections closed due to SetMaxIdleConns."),(0,r.kt)("h4",{id:"labels-25"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h3",{id:"buildbuddy_sql_max_idle_time_closed-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_max_idle_time_closed"))," (Counter)"),(0,r.kt)("p",null,"The total number of connections closed due to SetConnMaxIdleTime."),(0,r.kt)("h4",{id:"labels-26"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h3",{id:"buildbuddy_sql_max_lifetime_closed-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_sql_max_lifetime_closed"))," (Counter)"),(0,r.kt)("p",null,"The total number of connections closed due to SetConnMaxLifetime."),(0,r.kt)("h4",{id:"labels-27"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"sql_db_role"),": SQL DB replica role: ",(0,r.kt)("inlineCode",{parentName:"li"},"primary")," for read+write replicas, or ",(0,r.kt)("inlineCode",{parentName:"li"},"read_replica")," for read-only DB replicas.")),(0,r.kt)("h2",{id:"http-metrics"},"HTTP metrics"),(0,r.kt)("h3",{id:"buildbuddy_http_request_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_http_request_count"))," (Counter)"),(0,r.kt)("p",null,"HTTP request count."),(0,r.kt)("h4",{id:"labels-28"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"route"),": HTTP route before substituting path parameters (",(0,r.kt)("inlineCode",{parentName:"li"},"/invocation/:id"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"/settings"),", ...)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"method"),": HTTP method: ",(0,r.kt)("inlineCode",{parentName:"li"},"GET"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"POST"),", ...")),(0,r.kt)("h4",{id:"examples-15"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Requests per second, by status code\nsum by (code) (rate(buildbuddy_http_request_count[5m]))\n\n# 5xx error ratio\nsum(rate(buildbuddy_http_request_count{code=~"5.."}[5m]))\n  /\nsum(rate(buildbuddy_http_request_count[5m]))\n')),(0,r.kt)("h3",{id:"buildbuddy_http_request_handler_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_http_request_handler_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Time taken to handle each HTTP request in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-29"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"route"),": HTTP route before substituting path parameters (",(0,r.kt)("inlineCode",{parentName:"li"},"/invocation/:id"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"/settings"),", ...)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"method"),": HTTP method: ",(0,r.kt)("inlineCode",{parentName:"li"},"GET"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"POST"),", ..."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code"),": HTTP response code: ",(0,r.kt)("inlineCode",{parentName:"li"},"200"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"302"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"401"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"404"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"500"),", ...")),(0,r.kt)("h4",{id:"examples-16"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},'# Median request duration for successfuly processed (2xx) requests.\n# Other status codes may be associated with early-exits and are\n# likely to add too much noise.\nhistogram_quantile(\n  0.5,\n  sum by (le)   (rate(buildbuddy_http_request_handler_duration_usec{code=~"2.."}[5m]))\n)\n')),(0,r.kt)("h3",{id:"buildbuddy_http_response_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_http_response_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Response size of each HTTP response in ",(0,r.kt)("strong",{parentName:"p"},"bytes"),"."),(0,r.kt)("h4",{id:"labels-30"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"route"),": HTTP route before substituting path parameters (",(0,r.kt)("inlineCode",{parentName:"li"},"/invocation/:id"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"/settings"),", ...)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"method"),": HTTP method: ",(0,r.kt)("inlineCode",{parentName:"li"},"GET"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"POST"),", ..."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code"),": HTTP response code: ",(0,r.kt)("inlineCode",{parentName:"li"},"200"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"302"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"401"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"404"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"500"),", ...")),(0,r.kt)("h4",{id:"examples-17"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-promql"},"# Median HTTP response size\nhistogram_quantile(\n  0.5,\n  sum by (le)   (rate(buildbuddy_http_response_size_bytes[5m]))\n)\n")),(0,r.kt)("h2",{id:"internal-metrics"},"Internal metrics"),(0,r.kt)("p",null,"These metrics are for monitoring lower-level subsystems of BuildBuddy."),(0,r.kt)("h3",{id:"build-event-handler"},"Build event handler"),(0,r.kt)("p",null,"The build event handler logs all build events uploaded to BuildBuddy\nas part of the Build Event Protocol."),(0,r.kt)("h3",{id:"buildbuddy_build_event_handler_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_build_event_handler_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"The time spent handling each build event in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-31"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),".")),(0,r.kt)("h3",{id:"cache"},"Cache"),(0,r.kt)("p",null,'"Cache" refers to the cache backend(s) that BuildBuddy uses to\naccelerate file IO operations, which are common in different\nsubsystems such as the remote cache and the fetch server (for\ndownloading invocation artifacts).'),(0,r.kt)("p",null,"BuildBuddy can be configured to use multiple layers of caching\n(an in-memory layer, coupled with a cloud storage layer)."),(0,r.kt)("h4",{id:"get-metrics"},(0,r.kt)("inlineCode",{parentName:"h4"},"get")," metrics"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"get")," metrics track non-streamed cache reads (all data is fetched\nfrom the cache in a single request)."),(0,r.kt)("h3",{id:"buildbuddy_cache_get_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_get_count"))," (Counter)"),(0,r.kt)("p",null,"Number of cache get requests."),(0,r.kt)("h4",{id:"labels-32"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_get_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_get_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"The time spent retrieving each entry from the cache, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("p",null,"This is recorded only for successful gets."),(0,r.kt)("h4",{id:"labels-33"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_get_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_get_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Size of each entry retrieved from the cache, in ",(0,r.kt)("strong",{parentName:"p"},"bytes"),"."),(0,r.kt)("p",null,"This is recorded only for successful gets."),(0,r.kt)("h4",{id:"labels-34"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h4",{id:"read-metrics"},(0,r.kt)("inlineCode",{parentName:"h4"},"read")," metrics"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"read")," metrics track streamed cache reads."),(0,r.kt)("h3",{id:"buildbuddy_cache_read_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_read_count"))," (Counter)"),(0,r.kt)("p",null,"Number of streamed cache reads started."),(0,r.kt)("p",null,"This is incremented once for each started stream, ",(0,r.kt)("strong",{parentName:"p"},"not")," for each chunk in the stream."),(0,r.kt)("h4",{id:"labels-35"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_read_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_read_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"The total time spent for each read stream, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("p",null,"This is recorded only for successful reads, and measures the entire read stream (not just individual chunks)."),(0,r.kt)("h4",{id:"labels-36"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_read_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_read_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Total size of each entry retrieved from the cache via streaming, in ",(0,r.kt)("strong",{parentName:"p"},"bytes"),"."),(0,r.kt)("p",null,"This is recorded only on success, and measures the entire stream (not just individual chunks)."),(0,r.kt)("h4",{id:"labels-37"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h4",{id:"set-metrics"},(0,r.kt)("inlineCode",{parentName:"h4"},"set")," metrics"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"set")," metrics track non-streamed cache writes (all data is wrtiten\nin a single request)."),(0,r.kt)("h3",{id:"buildbuddy_cache_set_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_set_count"))," (Counter)"),(0,r.kt)("p",null,"Number of cache set requests."),(0,r.kt)("h4",{id:"labels-38"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_set_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_set_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"The time spent writing each entry to the cache, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("p",null,"This is recorded only for successful sets."),(0,r.kt)("h4",{id:"labels-39"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_set_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_set_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Size of the value stored in each set operation, in ",(0,r.kt)("strong",{parentName:"p"},"bytes"),"."),(0,r.kt)("p",null,"This is recorded only for successful sets."),(0,r.kt)("h4",{id:"labels-40"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_set_retries-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_set_retries"))," (Histogram)"),(0,r.kt)("p",null,"Number of retries required to fulfill the set request (an observed value of 0 means the transfer succeeded on the first try)."),(0,r.kt)("h4",{id:"labels-41"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h4",{id:"write-metrics"},(0,r.kt)("inlineCode",{parentName:"h4"},"write")," metrics"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"write")," metrics track streamed cache writes."),(0,r.kt)("h3",{id:"buildbuddy_cache_write_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_write_count"))," (Counter)"),(0,r.kt)("p",null,"Number of streamed cache writes started."),(0,r.kt)("p",null,"This is incremented once for each started stream, ",(0,r.kt)("strong",{parentName:"p"},"not")," for each chunk in the stream."),(0,r.kt)("h4",{id:"labels-42"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_write_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_write_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"The time spent for each streamed write to the cache, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("p",null,"This is recorded only on success, and measures the entire stream (not just individual chunks)."),(0,r.kt)("h4",{id:"labels-43"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_write_size_bytes-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_write_size_bytes"))," (Histogram)"),(0,r.kt)("p",null,"Size of each entry written to the cache via streaming, in ",(0,r.kt)("strong",{parentName:"p"},"bytes"),"."),(0,r.kt)("p",null,"This is recorded only on success, and measures the entire stream (not just individual chunks)."),(0,r.kt)("h4",{id:"labels-44"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_write_retries-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_write_retries"))," (Histogram)"),(0,r.kt)("p",null,"Number of retries required to write each chunk in the stream (an observed value of 0 means the transfer succeeded on the first try)."),(0,r.kt)("h4",{id:"labels-45"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"other-cache-metrics"},"Other cache metrics"),(0,r.kt)("h3",{id:"buildbuddy_cache_delete_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_delete_count"))," (Counter)"),(0,r.kt)("p",null,"Number of deletes from the cache."),(0,r.kt)("h4",{id:"labels-46"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_delete_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_delete_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Duration of each cache deletion, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-47"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_contains_count-counter"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_contains_count"))," (Counter)"),(0,r.kt)("p",null,"Number of ",(0,r.kt)("inlineCode",{parentName:"p"},"contains(key)")," requests made to the cache."),(0,r.kt)("h4",{id:"labels-48"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status"),": Status code as defined by ",(0,r.kt)("a",{parentName:"li",href:"https://godoc.org/google.golang.org/grpc/codes#Code"},"grpc/codes"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_contains_duration_usec-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_contains_duration_usec"))," (Histogram)"),(0,r.kt)("p",null,"Duration of each each ",(0,r.kt)("inlineCode",{parentName:"p"},"contains(key)")," request, in ",(0,r.kt)("strong",{parentName:"p"},"microseconds"),"."),(0,r.kt)("h4",{id:"labels-49"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")),(0,r.kt)("h3",{id:"buildbuddy_cache_contains_retry_count-histogram"},(0,r.kt)("strong",{parentName:"h3"},(0,r.kt)("inlineCode",{parentName:"strong"},"buildbuddy_cache_contains_retry_count"))," (Histogram)"),(0,r.kt)("p",null,"Number of retries required to fulfill each ",(0,r.kt)("inlineCode",{parentName:"p"},"contains(key)")," request to the cache (an observed value of 0 means the request succeeded on the first try)."),(0,r.kt)("h4",{id:"labels-50"},"Labels"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"tier"),": Cache tier: ",(0,r.kt)("inlineCode",{parentName:"li"},"memory")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud"),". This label can be used to write Prometheus queries that don't break if the cache backend is swapped out for a different backend."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"backend"),": Cache backend: ",(0,r.kt)("inlineCode",{parentName:"li"},"gcs")," (Google Cloud Storage), ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_s3"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"redis"),".")))}u.isMDXComponent=!0}}]);